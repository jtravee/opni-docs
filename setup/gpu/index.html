
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/rancher/opni-docs/setup/gpu/">
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.4">
    
    
      
        <title>Cluster GPU Configuration - Rancher Opni</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bb3983ee.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans:300,400,400i,700%7C&display=fallback">
        <style>:root{--md-text-font:"Work Sans";--md-code-font:""}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-56382716-14","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="purple" data-md-color-accent="purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#automatic-gpu-operator-configuration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Rancher Opni" class="md-header__button md-logo" aria-label="Rancher Opni" data-md-component="logo">
      
  <img src="../../assets/logo-horizontal-opni-no-bg.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Rancher Opni
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cluster GPU Configuration
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="purple" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="purple" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/rancher/opni" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Rancher Opni" class="md-nav__button md-logo" aria-label="Rancher Opni" data-md-component="logo">
      
  <img src="../../assets/logo-horizontal-opni-no-bg.png" alt="logo">

    </a>
    Rancher Opni
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rancher/opni" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Opni - AIOps for Kubernetes
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Deployment
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Deployment
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/quickstart/" class="md-nav__link">
        Quickstart
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/basic/" class="md-nav__link">
        Basic Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deployment/advanced/" class="md-nav__link">
        Advanced Installation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Setup Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Setup Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Setup Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Cluster GPU Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Cluster GPU Configuration
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#automatic-gpu-operator-configuration" class="md-nav__link">
    Automatic GPU Operator Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gpu-node-hardware-requirements" class="md-nav__link">
    GPU Node Hardware Requirements:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-cluster-requirements" class="md-nav__link">
    Kubernetes Cluster Requirements:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-custom-resources" class="md-nav__link">
    Install Custom Resources
  </a>
  
    <nav class="md-nav" aria-label="Install Custom Resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gpupolicyadapter" class="md-nav__link">
    GPUPolicyAdapter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#provider-specific-notes-and-troubleshooting" class="md-nav__link">
    Provider-specific Notes and Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Provider-specific Notes and Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k3s" class="md-nav__link">
    K3S
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rke" class="md-nav__link">
    RKE
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vgpu" class="md-nav__link">
    VGPU
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-notes" class="md-nav__link">
    Other Notes
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../log-shipping/" class="md-nav__link">
        Log Shipping
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../setup-grafana-dashboard/" class="md-nav__link">
        Setup Grafana Dashboard for Metric Service
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        Metrics Anomaly Detection (beta)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Architecture" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/highlevel/" class="md-nav__link">
        High-level Architecture
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Configuration" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/elasticsearch/" class="md-nav__link">
        Elasticsearch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/gpuadapter/" class="md-nav__link">
        GPU Policy Adapter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/logadapter/" class="md-nav__link">
        LogAdapter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/nats/" class="md-nav__link">
        NATS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/opnicluster/" class="md-nav__link">
        OpniCluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/pretrainedmodel/" class="md-nav__link">
        PretrainedModel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../configuration/s3/" class="md-nav__link">
        S3
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#automatic-gpu-operator-configuration" class="md-nav__link">
    Automatic GPU Operator Configuration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gpu-node-hardware-requirements" class="md-nav__link">
    GPU Node Hardware Requirements:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-cluster-requirements" class="md-nav__link">
    Kubernetes Cluster Requirements:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-custom-resources" class="md-nav__link">
    Install Custom Resources
  </a>
  
    <nav class="md-nav" aria-label="Install Custom Resources">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gpupolicyadapter" class="md-nav__link">
    GPUPolicyAdapter
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#provider-specific-notes-and-troubleshooting" class="md-nav__link">
    Provider-specific Notes and Troubleshooting
  </a>
  
    <nav class="md-nav" aria-label="Provider-specific Notes and Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k3s" class="md-nav__link">
    K3S
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rke" class="md-nav__link">
    RKE
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vgpu" class="md-nav__link">
    VGPU
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-notes" class="md-nav__link">
    Other Notes
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

  <h1>Cluster GPU Configuration</h1>

<h2 id="automatic-gpu-operator-configuration">Automatic GPU Operator Configuration<a class="headerlink" href="#automatic-gpu-operator-configuration" title="Permanent link">&para;</a></h2>
<p>Opni can utilize GPU acceleration to enable log anomaly detection for workload 
and application logs. If you would like Opni to learn from your own workloads, 
follow the instructions below to configure your cluster. If GPU acceleration
is not enabled, Opni can still analyze your Control Plane logs using our 
pretrained models.</p>
<p>Opni bundles its own modified version of the Nvidia GPU Operator which is the
recommended way to enable GPU acceleration. It may be possible to install the
upstream GPU Operator via helm chart, but this is not recommended, as it will 
likely not work with Opni. Follow the instructions below to enable GPU 
acceleration using Opni's built-in GPU Operator.</p>
<hr />
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<h3 id="gpu-node-hardware-requirements">GPU Node Hardware Requirements:<a class="headerlink" href="#gpu-node-hardware-requirements" title="Permanent link">&para;</a></h3>
<ul>
<li>1x NVIDIA GPU</li>
<li>If not using VGPU, any Quadro or Tesla GPU will work. </li>
<li>If using VGPU, one of the following GPUs is required:<ul>
<li>Tesla M6, M10, M60</li>
<li>Tesla P4, P6, P40, P100</li>
<li>Tesla V100</li>
<li>Quadro RTX 6000/8000</li>
<li>Tesla T4</li>
<li>NVIDIA A10, A16, A30, A40, A100, RTX A5000/A6000</li>
</ul>
</li>
<li>MIG is not supported when using automatic GPU Operator configuration at this time.</li>
<li>Ubuntu 20.04. No other host OS is supported at this time.</li>
<li>The GPU node should not have an Nvidia driver or container runtime installed.
  The GPU Operator handles installing all the necessary drivers automatically.</li>
</ul>
<h3 id="kubernetes-cluster-requirements">Kubernetes Cluster Requirements:<a class="headerlink" href="#kubernetes-cluster-requirements" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Vanilla upstream Kubernetes, or one of the following distributions:</p>
<ul>
<li>RKE</li>
<li>K3S &gt;= v1.22.2+k3s1</li>
<li>RKE2</li>
<li>Amazon EKS</li>
<li>Google GKE</li>
<li>Azure AKS</li>
</ul>
</li>
<li>
<p>Opni Operator installed</p>
</li>
<li>Cert-Manager installed </li>
<li>NFD installed (see deploy/examples/nfd_aio.yaml in the Opni repo)</li>
</ul>
<hr />
<h2 id="install-custom-resources">Install Custom Resources<a class="headerlink" href="#install-custom-resources" title="Permanent link">&para;</a></h2>
<h3 id="gpupolicyadapter">GPUPolicyAdapter<a class="headerlink" href="#gpupolicyadapter" title="Permanent link">&para;</a></h3>
<p>Creating a GPUPolicyAdapter resource will trigger the GPU Operator to start 
configuring the cluster. </p>
<p>If not using VGPU, the GPUPolicyAdapter resource does not need any customization,
and can be created with an empty spec, as follows:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opni.io/v1beta1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GpuPolicyAdapter</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpu</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span><span class="w"></span>
</code></pre></div>
<p>(note that the empty brackets after <code>spec:</code> are important)</p>
<p>If using VGPU, please follow the official documentation to build the VGPU driver
image, and create a GPUPolicyAdapter resource with the following spec, filling
in the <code>driver</code> and <code>licenseConfigMap</code> fields:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opni.io/v1beta1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GpuPolicyAdapter</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vgpu</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">images</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="c1"># Image name for the VGPU driver</span><span class="w"></span>
<span class="w">  </span><span class="nt">vgpu</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">licenseConfigMap</span><span class="p">:</span><span class="w"> </span><span class="c1"># ConfigMap containing gridd.conf and the client config token</span><span class="w"></span>
<span class="w">    </span><span class="nt">licenseServerKind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nls</span><span class="w"> </span>
</code></pre></div>
<p>Once the GPUPolicyAdapter resource is created, the GPU Operator will begin
configuring the cluster. This takes a few minutes, and the container engine
will be restarted during this process. Once all the pods in the <code>gpu-operator-resources</code>
namespace complete, GPUs will be available for use and the Opni GPU Controller
pod should start.</p>
<h2 id="provider-specific-notes-and-troubleshooting">Provider-specific Notes and Troubleshooting<a class="headerlink" href="#provider-specific-notes-and-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="k3s">K3S<a class="headerlink" href="#k3s" title="Permanent link">&para;</a></h3>
<ul>
<li>If you are using K3S, you must use v1.22.2+k3s1 or later. This version
    introduces automatic detection of Nvidia container runtimes on nodes, and
    a large number of bugfixes related to pod lifecycle were added in
    upstream Kubernetes for this release. If you are using an earlier version,
    you may experience issues where pods become stuck in the 'Terminating'
    state. If this happens, force-deleting the stuck pods should help resolve
    the issue.</li>
</ul>
<h3 id="rke">RKE<a class="headerlink" href="#rke" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>RKE uses Docker as its container engine. If you are using RKE, you should
    be aware of how the Nvidia runtime interacts with Docker. When the GPU
    operator is installed for the first time, it will create a <code>RuntimeClass</code>
    object which allows Kubernetes to use the <code>nvidia</code> runtime, which is 
    configured in the docker engine itself. The RuntimeClass will look similar
    to this when using RKE:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node.k8s.io/v1alpha1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RuntimeClass</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nvidia</span><span class="w"></span>
<span class="nt">handler</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker</span><span class="w"></span>
</code></pre></div>
<p>The RuntimeClass <code>name</code> is used in a pod spec to identify the runtime to use.
It is specified using the <code>runtimeClassName</code> field:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="c1"># ...</span><span class="w"></span>
<span class="w">  </span><span class="nt">runtimeClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nvidia</span><span class="w"></span>
<span class="w">  </span><span class="c1"># ...</span><span class="w"></span>
</code></pre></div>
<p>When using containerd for example, the <code>handler</code> field in the <code>RuntimeClass</code>
is used to select a specific container runtime by name. However, dockershim
does not support selecting custom container runtimes, meaning the nvidia
container runtime <em>must</em> be set as the default. The GPU Operator will still
utilize a <code>RuntimeClass</code>, but its <code>handler</code> must be set to <code>docker</code> to
work. Otherwise, you may see an error like this:</p>
<blockquote>
<p>Failed to create pod sandbox: rpc error: code = Unknown desc = RuntimeHandler "nvidia" not supported</p>
</blockquote>
<p>If you encounter this error, check the <code>handler</code> field in the <code>RuntimeClass</code>
and ensure it is set to <code>docker</code>. </p>
</li>
</ul>
<h2 id="vgpu">VGPU<a class="headerlink" href="#vgpu" title="Permanent link">&para;</a></h2>
<p>If you are using VGPUs, you should be aware of the following:</p>
<ul>
<li>Nvidia gridd <em>does not</em> run on the virtualization host. Instead, it runs in
  guest VMs - when using the GPU Operator, gridd runs inside the nvidia driver
  daemonset pod.</li>
<li>The VGPU driver must match the driver on the host. When downloading the 
  driver package from the Nvidia License Portal, you will be presented with 
  two driver runfiles, for example:</li>
<li><code>NVIDIA-Linux-x86_64-470.63-vgpu-kvm.run</code> - Installed on the <strong>host</strong></li>
<li><code>NVIDIA-Linux-x86_64-470.63.01-grid.run</code> - Installed on the <strong>guest</strong> (automatic with GPU operator)</li>
</ul>
<p>Ensure the correct drivers are used for the host and guest. </p>
<ul>
<li>CUDA drivers do not need to be installed on the virtualization host (and are not
  included by default with the VGPU driver)</li>
<li>
<p>VGPU mediated device UUIDs are not persistent across reboots. This can cause
  libvirt to fail after a reboot if you are running a VM with VGPUs. To fix this:</p>
</li>
<li>
<p>List instances on the host with <code>virsh list --all</code> (the instance will be shut off)</p>
</li>
<li>
<p>Find the instance that has the VGPU. If you don't know which one it is,
    use the <code>virsh edit</code> command to view the XML configuration of each instance
    and search for <code>mdev</code>.</p>
</li>
<li>
<p>Undefine the instance using <code>virsh undefine</code> and restart libvirtd.</p>
</li>
<li>
<p>You might not be able to determine from the host whether a guest VGPU
  is licensed. To check license status, you should open a shell to a pod
  running with the nvidia container runtime and use <code>nvidia-smi</code> from there.</p>
</li>
<li>On the virtualization host, you may notice that your physical GPU is bound to
  the <code>nvidia</code> driver, even though the <code>nvidia_vgpu_vfio</code> driver is available.
  The official docs are ambiguous on this, but your GPU should be bound to
  the <code>nvidia</code> driver. The guest VGPU will also be bound to the <code>nvidia</code> driver
  once the guest drivers are installed.</li>
</ul>
<h2 id="other-notes">Other Notes<a class="headerlink" href="#other-notes" title="Permanent link">&para;</a></h2>
<ul>
<li>The <code>nvidia.com/gpu</code> resource request behaves counterintuitively. It serves as 
  a node scheduling hint for pods, and to keep track of which/how many pods are 
  using GPUs. <code>nvidia.com/gpu</code> a first-class node resource just like cpu and 
  memory. If a pod makes a request for one, the node it is scheduled on must 
  have that resource available. The existence of this resource request does 
  not equate to a pod taking exclusive ownership of the device. In fact, a pod
  can use a GPU without requesting an <code>nvidia.com/gpu</code> resource at all, as long
  as it has the correct environment variables and <code>runtimeClassName</code> set. 
  This is how the GPU Operator pods are configured - they do not request GPU
  resources by design, rather they are scheduled onto GPU nodes by other means
  and set up to use the nvidia container runtime. </li>
<li>
<p>Regardless of <code>nvidia.com/gpu</code> resource requests or container runtime, GPUs
  will <em>only</em> be available if the <code>NVIDIA_VISIBLE_DEVICES</code> and 
  <code>NVIDIA_DRIVER_CAPABILITIES</code> environment variables are set correctly. They 
  should be set as follows:</p>
<ul>
<li><code>NVIDIA_VISIBLE_DEVICES=all</code></li>
<li><code>NVIDIA_DRIVER_CAPABILITIES=compute,utility</code></li>
</ul>
<p>They can be set either in the pod spec, or in the docker image itself
by using <code>ENV</code> in the Dockerfile.</p>
</li>
<li>
<p>If you are not using the GPU operator, but you are using the nvidia device
  plugin daemonset by itself, be aware that you must patch the daemonset to 
  include <code>runtimeClassName: nvidia</code> in its pod template. The GPU operator will
  do this automatically, but the daemonset does not have it set by default.</p>
</li>
<li>The GPU Operator installs the drivers in such a way that they are not 
  directly visible or usable by the host. As such, tools like <code>nvidia-smi</code> will
  not be available, so you will need to exec into a pod running with the nvidia
  container runtime to interact with a GPU.</li>
<li>A common way to pass a GPU through to a virtual machine is by using the
  vfio-pci driver. There are several tutorials online that explain how to set 
  up vfio-pci. It is important to note that some Nvidia GPUs expose additional
  PCI devices (such as an audio or usb controller) in the same IOMMU group
  as the GPU device itself. When binding the GPU device to the vfio-pci driver, 
  ensure that any additional devices belonging to the GPU are bound as well.</li>
</ul>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../deployment/advanced/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Advanced Installation" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Advanced Installation
            </div>
          </div>
        </a>
      
      
        
        <a href="../log-shipping/" class="md-footer__link md-footer__link--next" aria-label="Next: Log Shipping" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Log Shipping
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.361d90f1.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.289a2a4b.min.js"></script>
      
    
  </body>
</html>